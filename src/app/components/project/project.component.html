<div *ngIf="project" class="project-container">
  <header class="project-header">
    <div class="project-title">
      <div>
        <h1>{{project.name}}</h1>
      </div>
      <div>
        <button
        *ngIf="!isEditing"
        (click)="toggleEdit()"
        class="inline-flex items-center px-4 py-2 mr-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
        <div class="w-4 h-4 mr-2">
          <img src="app/assets/icons/update.png" width="15" alt="">
        </div>  
        Edit
      </button>
        <a class="text-black hover:no-underline px-5 py-2 rounded-3xl hover:bg-gray-300 hover:text-black" [routerLink]="['/backlog', project.id]"> Backlog </a>

      </div>
    </div>
  </header>

  <form *ngIf="isEditing" [formGroup]="editForm" (ngSubmit)="onSubmit()" class="project-content space-y-4 mt-4">
    <div>
      <label class="block mb-2">Project Name</label>
      <input formControlName="name" class="w-full p-2 border rounded">
    </div>

    <div>
      <label class="block mb-2">Description</label>
      <textarea formControlName="description" class="w-full p-2 border rounded h-32"></textarea>
    </div>

    <div>
      <label class="block mb-2">Budget ($)</label>
      <input type="number" formControlName="budget" class="w-full p-2 border rounded"/>
      <div *ngIf="budgetControl?.errors?.['minCurrentBudget'] && budgetControl?.touched" 
           class="text-red-500 text-sm mt-1">
        Le budget ne peut pas être inférieur au budget actuel ({{project.budget}} $)
      </div>
    </div>

    <div class="mt-4">
      <label class="block mb-2">Project Users</label>
      
      <!-- users actuels -->
      <div class="flex flex-wrap gap-2 mb-4">
        <div *ngFor="let user of project.users" 
        class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium"
        [ngClass]="{
          'bg-indigo-100 text-indigo-800': user !== project.createdBy,
          'bg-amber-100 text-amber-800': user === project.createdBy
        }"
        >
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
            </svg>
            {{ user || 'Non assigné' }}
        
          <button type="button"
              *ngIf="user !== project.createdBy"
              (click)="removeUser(user)"
              class="ml-2 text-red-500 hover:text-red-700">
              <img src="app/assets/icons/cancel-indigo.png" width="15" alt="">
          </button>
        </div>
      </div>

      <!-- recherche des users -->
      <div class="relative">
        <input
          type="text"
          [placeholder]="'Search users to add...'"
          (input)="searchUsers($event)"
          (focus)="onUserSearchFocus()"
          (blur)="onUserSearchBlur()"
          class="w-full p-2 border rounded"
        />

        <!-- affichage des users trouvés -->  
        <div *ngIf="showUserResults && filteredUsers.length > 0"
             class="absolute z-10 w-full mt-1 bg-white border rounded shadow-lg">
          <div *ngFor="let user of filteredUsers"
               (mousedown)="addUser(user)"
               class="p-2 hover:bg-gray-100 cursor-pointer">
            {{ user }}
          </div>
        </div>
      </div>
    </div>

    <div class="flex gap-2">
      <button type="submit" [disabled]="editForm.invalid" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 disabled:opacity-50">
        Save Changes
      </button>
      <button type="button" (click)="toggleEdit()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
        Cancel
      </button>
    </div>
  </form>

  <main *ngIf="!isEditing" class="project-content">
    <section class="project-description">
      <p>{{project.description || 'No description provided'}}</p>
    </section>

    <section class="project-budget">
      <p><strong>Budget:</strong> {{project.budget}} €</p>
    </section>

    <section class="project-recent-Participants">
      <h2>Participants</h2>
      <div class="Participants-list">
        <div class="Participants-item">

          <ul class="Participants-details">
            <li *ngFor="let user of project.users">
              <div class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium"
              [ngClass]="{
                'bg-indigo-100 text-indigo-800': user !== project.createdBy,
                'bg-amber-100 text-amber-800': user === project.createdBy
              }">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                </svg>
                {{ user || 'Non assigné' }}
              </div>
            </li>
          </ul>
        </div>
      </div>
    </section>
  </main>
</div>


