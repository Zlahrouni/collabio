<div class="max-w-3xl mx-auto bg-white dark:bg-gray-800 p-5 rounded-lg shadow-sm">
  <!-- Error Messages Section -->
  <div tabindex="-1"
       id="error-messages"
       *ngIf="errorMessages.length > 0"
       class="bg-red-100 dark:bg-red-900/50 border border-red-400 dark:border-red-800 text-red-700 dark:text-red-200 px-4 py-3 rounded-lg mb-4">
    <p class="font-medium">Please fix the following errors:</p>
    <ul class="list-disc list-inside">
      <li *ngFor="let errorMessage of errorMessages">{{ errorMessage }}</li>
    </ul>
  </div>

  <form [formGroup]="userStoryForm!" class="space-y-6">
    <!-- Title Section -->
    <div>
      <label class="block mb-2 text-gray-700 dark:text-gray-300 font-medium">User Story Title</label>
      <input
        type="text"
        formControlName="title"
        placeholder="Briefly describe the feature"
        class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700 placeholder-gray-400 dark:placeholder-gray-500 focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400 transition-all"
      >
    </div>

    <!-- Description Section -->
    <div>
      <label class="block mb-2 text-gray-700 dark:text-gray-300 font-medium">Description</label>
      <textarea
        formControlName="description"
        placeholder="Detail the user story, acceptance criteria, etc."
        class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700 placeholder-gray-400 dark:placeholder-gray-500 min-h-[150px] resize-y focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400 transition-all"
      ></textarea>
    </div>

    <!-- Type and Priority Section -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label class="block mb-2 text-gray-700 dark:text-gray-300 font-medium">Type</label>
        <select
          formControlName="type"
          class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400 transition-all"
        >
          <option *ngFor="let type of types" [value]="type">{{type}}</option>
        </select>
      </div>

      <div>
        <label class="block mb-2 text-gray-700 dark:text-gray-300 font-medium">Priority</label>
        <select
          formControlName="priority"
          class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400 transition-all"
        >
          <option *ngFor="let priority of priorities" [value]="priority">{{priority}}</option>
        </select>
      </div>
    </div>

    <!-- Story Points Section -->
    <div>
      <label class="block mb-2 text-gray-700 dark:text-gray-300 font-medium">Story Points</label>
      <input
        type="number"
        formControlName="storyPoints"
        placeholder="Estimate the effort required"
        class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700 placeholder-gray-400 dark:placeholder-gray-500 focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400 transition-all"
      />
    </div>

    <!-- Assign To Section -->
    <div>
      <label class="block mb-2 text-gray-700 dark:text-gray-300 font-medium">Assign To</label>

      <!-- User Search Input -->
      <div *ngIf="selectedUsers.trim() == ''">
        <div class="flex">
          <input
            type="text"
            placeholder="Search for team members..."
            (focus)="onFocus()"
            (blur)="onBlur()"
            (input)="searchUsers($event)"
            class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-l-lg text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700 placeholder-gray-400 dark:placeholder-gray-500 focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400 transition-all"
          />
          <button
            type="button"
            class="px-6 bg-indigo-600 dark:bg-indigo-500 text-white rounded-r-lg hover:bg-indigo-700 dark:hover:bg-indigo-400 transition-colors"
          >
            Search
          </button>
        </div>

        <!-- Search Results Dropdown -->
        <div
          *ngIf="isFocused && filteredUsers.length > 0"
          class="mt-2 border border-gray-200 dark:border-gray-600 rounded-lg shadow-lg bg-white dark:bg-gray-700"
        >
          <div
            *ngFor="let user of filteredUsers"
            class="flex items-center justify-between p-3 border-b border-gray-200 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-600 cursor-pointer text-gray-900 dark:text-gray-100"
            (mousedown)="addUser(user)"
          >
            <div class="font-medium">{{ user | truncate : 15 }}</div>
          </div>
        </div>
      </div>

      <!-- Selected User -->
      <div *ngIf="selectedUsers.trim() !== ''"
           class="flex items-center justify-between p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700">
        <span class="text-gray-700 dark:text-gray-300">{{selectedUsers}}</span>
        <button
          type="button"
          class="px-3 py-1 text-sm text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 hover:bg-red-50 dark:hover:bg-red-900/50 rounded-lg transition-colors"
          (click)="removeUser(selectedUsers)"
        >
          Remove
        </button>
      </div>
    </div>

    <!-- Submit Button -->
    <div class="flex justify-end pt-4">
      <button
        class="px-6 py-3 bg-indigo-600 dark:bg-indigo-500 text-white rounded-lg hover:bg-indigo-700 dark:hover:bg-indigo-400 transition-colors focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400 focus:ring-offset-2"
        (click)="onSubmit()"
      >
        Create User Story
      </button>
    </div>
  </form>
</div>
