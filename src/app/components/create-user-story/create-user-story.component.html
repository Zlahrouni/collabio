<div class="create-user-story-container max-w-3xl mx-auto bg-white font-sans p-5 shadow-sm">
  <!-- Error Messages Section -->
  <div tabindex="-1" id="error-messages" *ngIf="errorMessages.length > 0"
       class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4">
    <p class="font-medium">Please fix the following errors:</p>
    <ul class="list-disc list-inside">
      <li *ngFor="let errorMessage of errorMessages">{{ errorMessage }}</li>
    </ul>
  </div>

  <form [formGroup]="userStoryForm!" class="user-story-form space-y-6">
    <!-- Title Section -->
    <div class="form-section">
      <div class="form-group">
        <label class="block mb-2 text-gray-700 font-medium">User Story Title</label>
        <input
          type="text"
          formControlName="title"
          placeholder="Briefly describe the feature"
          class="form-control w-full p-3 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
        >
      </div>
    </div>

    <!-- Description Section -->
    <div class="form-group">
      <label class="block mb-2 text-gray-700 font-medium">Description</label>
      <textarea
        formControlName="description"
        placeholder="Detail the user story, acceptance criteria, etc."
        class="form-control w-full p-3 border border-gray-300 rounded-md text-sm min-h-[150px] resize-y focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
      ></textarea>
    </div>

    <!-- Type and Priority Section -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div class="form-group">
        <label class="block mb-2 text-gray-700 font-medium">Type</label>
        <select
          formControlName="type"
          class="form-control w-full p-3 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
        >
          <option *ngFor="let type of types" [value]="type">{{type}}</option>
        </select>
      </div>

      <div class="form-group">
        <label class="block mb-2 text-gray-700 font-medium">Priority</label>
        <select
          formControlName="priority"
          class="form-control w-full p-3 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
        >
          <option *ngFor="let priority of priorities" [value]="priority">{{priority}}</option>
        </select>
      </div>
    </div>

    <!-- Story Points Section -->
    <div class="form-group">
      <label class="block mb-2 text-gray-700 font-medium">Story Points</label>
      <input
        type="number"
        formControlName="storyPoints"
        placeholder="Estimate the effort required"
        class="form-control w-full p-3 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"/>
    </div>

    <!-- Assign To Section -->
    <div class="form-group">
      <label class="block mb-2 text-gray-700 font-medium">Assign To</label>

      <!-- User Search Input -->
      <div *ngIf="selectedUsers.trim() == ''">
        <div class="flex">
          <input
            type="text"
            class="w-full p-3 border border-gray-300 rounded-l-md text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
            placeholder="Search for team members..."
            (focus)="onFocus()"
            (blur)="onBlur()"
            (input)="searchUsers($event)"
          />
          <button
            type="button"
            class="px-6 bg-blue-500 text-white rounded-r-md hover:bg-blue-600 transition-colors"
          >
            Search
          </button>
        </div>

        <!-- Dropdown Results -->
        <div
          *ngIf="isFocused && filteredUsers.length > 0"
          class="mt-2 border rounded-md shadow-lg bg-white"
        >
          <div
            *ngFor="let user of filteredUsers"
            class="flex items-center p-3 border-b hover:bg-gray-50 cursor-pointer transition-colors"
            (mousedown)="addUser(user)"
          >
            <div class="font-medium text-gray-700">{{ user | truncate : 15 }}</div>
          </div>
        </div>
      </div>

      <!-- Selected User -->
      <div *ngIf="selectedUsers.trim() !== ''"
           class="flex items-center justify-between p-3 border border-gray-300 rounded-md bg-gray-50">
        <span class="text-gray-700">{{selectedUsers}}</span>
        <button
          type="button"
          class="px-3 py-1 text-sm text-red-600 hover:text-red-700 hover:bg-red-50 rounded-md transition-colors"
          (click)="removeUser(selectedUsers)"
        >
          Remove
        </button>
      </div>
    </div>

    <!-- Submit Button -->
    <div class="flex justify-end pt-4">
      <button
        class="px-6 py-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
        (click)="onSubmit()"
      >
        Create User Story
      </button>
    </div>
  </form>
</div>
