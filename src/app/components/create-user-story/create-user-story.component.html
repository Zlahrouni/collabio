<div class="create-user-story-container">
  <div class="user-story-header">
    <h1>Créer une User Story</h1>
    <div class="header-actions">
      <button 
        class="btn btn-cancel" 
        (click)="onCancel()"
        [disabled]="isSubmitting"
      >
        Annuler
      </button>
      <button 
        class="btn btn-primary" 
        (click)="onSubmit()" 
        [disabled]="userStoryForm.invalid || isSubmitting"
      >
        {{ isSubmitting ? 'Création en cours...' : 'Créer' }}
      </button>
    </div>
  </div>

  <!-- Affichage des erreurs globales -->
  <div *ngIf="submitError" class="alert alert-danger">
    {{ submitError }}
  </div>

  <form [formGroup]="userStoryForm" class="user-story-form">
    <div class="form-section">
      <div class="form-group">
        <label>Titre de la User Story</label>
        <input 
          type="text" 
          formControlName="title"
          placeholder="Décrivez brièvement la fonctionnalité"
          class="form-control"
          [class.is-invalid]="isFieldInvalid('title')"
        >
        <div *ngIf="isFieldInvalid('title')" class="invalid-feedback">
          {{ getErrorMessage('title') }}
        </div>
      </div>

      <div class="form-group description-group">
        <label>Description</label>
        <textarea 
          formControlName="description"
          placeholder="Détaillez la user story, les critères d'acceptance, etc."
          class="form-control description-input"
          [class.is-invalid]="isFieldInvalid('description')"
        ></textarea>
        <div *ngIf="isFieldInvalid('description')" class="invalid-feedback">
          {{ getErrorMessage('description') }}
        </div>
      </div>
    </div>

    <div class="form-section metadata-section">
      <div class="form-row">
        <div class="form-group">
          <label>Type</label>
          <select 
            formControlName="type" 
            class="form-control"
            [class.is-invalid]="isFieldInvalid('type')"
          >
            <option *ngFor="let type of types" [value]="type">{{type}}</option>
          </select>
          <div *ngIf="isFieldInvalid('type')" class="invalid-feedback">
            {{ getErrorMessage('type') }}
          </div>
        </div>

        <div class="form-group">
          <label>Statut</label>
          <select 
            formControlName="status" 
            class="form-control"
            [class.is-invalid]="isFieldInvalid('status')"
          >
            <option *ngFor="let stat of status" [value]="stat">{{stat}}</option>
          </select>
          <div *ngIf="isFieldInvalid('status')" class="invalid-feedback">
            {{ getErrorMessage('status') }}
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Points de Story</label>
          <select 
            formControlName="storyPoints" 
            class="form-control"
            [class.is-invalid]="isFieldInvalid('storyPoints')"
          >
            <option *ngFor="let points of storyPoints" [value]="points">{{points}}</option>
          </select>
          <div *ngIf="isFieldInvalid('storyPoints')" class="invalid-feedback">
            {{ getErrorMessage('storyPoints') }}
          </div>
        </div>

        <div class="form-group">
          <label>Assigné</label>
          <select
            class="form-control"
            [class.is-invalid]="isFieldInvalid('assignedTo')"
          >
            <option value="">Sélectionnez un utilisateur</option>
            <!--option 
              *ngFor="let user of users$ | async" 
              [value]="user.id"
            >
              {{user.name}}
            </-option-->
          </select>
          <div *ngIf="isFieldInvalid('assignedTo')" class="invalid-feedback">
            {{ getErrorMessage('assignedTo') }}
          </div>
        </div>
      </div>
    </div>
  </form>
</div>