<nav class="bg-white border-gray-200 dark:bg-gray-900">
  <div class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4">
    <div class="flex items-center space-x-3 rtl:space-x-reverse">
      <a routerLink="" class="flex items-center">
        <img src="app/assets/logo_long.png" class="h-10" alt="Collabio Logo"/>
      </a>
    </div>
    <div class="flex-grow flex items-center justify-center" id="search-container">
      <div class="relative w-full max-w-md">
        <input
          type="text"
          [formControl]="searchControl"
          class="block w-full py-2 px-3 text-gray-900 rounded border border-gray-100 focus:outline-none focus:border-blue-500 dark:bg-gray-800 dark:text-white dark:border-gray-700"
          placeholder="Search projects..."
        />

        <!-- Loading indicator -->
        <div *ngIf="isSearching" class="absolute right-3 top-1/2 -translate-y-1/2">
          <div class="animate-spin rounded-full h-4 w-4 border-2 border-gray-500 border-t-transparent"></div>
        </div>

        <!-- Search Results Dropdown -->
        <div *ngIf="showSearchResults && searchResults.length > 0"
             class="absolute z-50 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md shadow-lg">
          <div class="max-h-96 overflow-y-auto">
            <div *ngFor="let project of searchResults"
                 (click)="navigateToProject(project.id)"
                 class="p-3 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer border-b border-gray-200 dark:border-gray-700 last:border-0">
              <div class="flex items-center">
                <div>
                  <h4 class="font-medium text-gray-900 dark:text-white">{{ project.name }}</h4>
                  <p class="text-sm text-gray-500 dark:text-gray-400">{{ project.description | truncate:100 }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- No Results Message -->
        <div *ngIf="showSearchResults && searchResults.length === 0 && searchControl.value"
             class="absolute z-50 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md shadow-lg">
          <div class="p-3 text-center text-gray-500 dark:text-gray-400">
            No projects found
          </div>
        </div>
      </div>
    </div>
    <div *ngIf="this.isConnected" class="flex items-center md:order-2 space-x-3 md:space-x-0 rtl:space-x-reverse">
      <!-- Username -->
      <div class="text-lg font-semibold text-blue-600 dark:text-blue-400 mr-4">
        {{username ?? '' | truncate: 20}}
      </div>

      <!-- Profile dropdown -->
      <div class="ml-3 relative">
        <div>
          <button
            class="flex text-sm border-2 border-transparent rounded-full focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400 transition duration-150 ease-in-out"
            id="user-menu"
            (click)="toggleMenu('profile-dropdown')"
            aria-label="User menu"
            aria-haspopup="true"
          >
            <img
              class="h-8 w-8 rounded-full"
              src="{{isDarkMode ? 'app/assets/icons/user-light.png' : 'app/assets/icons/user-dark.png'}}"
              alt="Profile image"
            />
          </button>
        </div>

        <!-- Dropdown Menu -->
        <div id="profile-dropdown" class="origin-top-right absolute right-0 mt-2 rounded-lg shadow-lg hidden">
          <div
            class="py-1 rounded-lg bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 shadow-lg text-nowrap"
            role="menu"
            aria-orientation="vertical"
            aria-labelledby="user-menu"
          >
            <!-- Theme Toggle -->
            <button
              class="block w-full px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors border-b border-gray-200 dark:border-gray-700"
              role="menuitem"
              (click)="toggleTheme()"
            >
              <div class="flex items-center">
                <!-- Sun icon -->
                <svg *ngIf="isDarkMode" class="w-4 h-4 mr-2 text-gray-700 dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
                </svg>
                <!-- Moon icon -->
                <svg *ngIf="!isDarkMode" class="w-4 h-4 mr-2 text-gray-700 dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
                </svg>
                {{ isDarkMode ? 'Switch to Light Mode' : 'Switch to Dark Mode' }}
              </div>
            </button>

            <!-- Logout Button -->
            <button
              class="block w-full px-4 py-2 text-sm text-white bg-red-600 hover:bg-red-700 dark:bg-red-700 dark:hover:bg-red-800 transition-colors rounded-b-lg"
              role="menuitem"
              (click)="logout()"
            >
              Sign out
            </button>
          </div>
        </div>
      </div>
    </div>
    <div *ngIf="!this.isConnected" >
      <div class="flex items-center space-x-3 rtl:space-x-reverse">
        <a href="/login" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Login</a>
        <a href="/register" class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">Get Started</a>
      </div>
    </div>
  </div>
</nav>
